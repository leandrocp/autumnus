local themes = {
	{
		name = "tokyonight_night",
		colorscheme = "tokyonight-night",
		appearance = "dark",
		plugin = {
			"folke/tokyonight.nvim",
			opts = { style = "night" },
		},
	},
	{
		name = "tokyonight_moon",
		colorscheme = "tokyonight-moon",
		appearance = "dark",
		plugin = {
			"folke/tokyonight.nvim",
			opts = { style = "moon" },
		},
	},
	{
		name = "tokyonight_storm",
		colorscheme = "tokyonight-storm",
		appearance = "dark",
		plugin = {
			"folke/tokyonight.nvim",
			opts = { style = "storm" },
		},
	},
	{
		name = "tokyonight_day",
		colorscheme = "tokyonight-day",
		appearance = "light",
		plugin = {
			"folke/tokyonight.nvim",
			opts = { style = "day" },
		},
	},
	{
		name = "catppuccin_frappe",
		colorscheme = "catppuccin-frappe",
		appearance = "dark",
		plugin = {
			"catppuccin/nvim",
			name = "catppuccin",
			opts = {},
		},
	},
	{
		name = "catppuccin_macchiato",
		colorscheme = "catppuccin-macchiato",
		appearance = "dark",
		plugin = {
			"catppuccin/nvim",
			name = "catppuccin",
			opts = {},
		},
	},
	{
		name = "catppuccin_mocha",
		colorscheme = "catppuccin-mocha",
		appearance = "dark",
		plugin = {
			"catppuccin/nvim",
			name = "catppuccin",
			opts = {},
		},
	},
	{
		name = "catppuccin_latte",
		colorscheme = "catppuccin-latte",
		appearance = "light",
		plugin = {
			"catppuccin/nvim",
			name = "catppuccin",
			opts = {},
		},
	},
	{
		name = "github_dark",
		colorscheme = "github_dark",
		appearance = "dark",
		plugin = {
			"projekt0n/github-nvim-theme",
			name = "github-theme",
			opts = {},
		},
	},
	{
		name = "github_dark_default",
		colorscheme = "github_dark_default",
		appearance = "dark",
		plugin = {
			"projekt0n/github-nvim-theme",
			name = "github-theme",
			opts = {},
		},
	},
	{
		name = "github_dark_dimmed",
		colorscheme = "github_dark_dimmed",
		appearance = "dark",
		plugin = {
			"projekt0n/github-nvim-theme",
			name = "github-theme",
			opts = {},
		},
	},
	{
		name = "github_dark_high_contrast",
		colorscheme = "github_dark_high_contrast",
		appearance = "dark",
		plugin = {
			"projekt0n/github-nvim-theme",
			name = "github-theme",
			opts = {},
		},
	},
	{
		name = "github_dark_colorblind",
		colorscheme = "github_dark_colorblind",
		appearance = "dark",
		plugin = {
			"projekt0n/github-nvim-theme",
			name = "github-theme",
			opts = {},
		},
	},
	{
		name = "github_dark_tritanopia",
		colorscheme = "github_dark_tritanopia",
		appearance = "dark",
		plugin = {
			"projekt0n/github-nvim-theme",
			name = "github-theme",
			opts = {},
		},
	},
	{
		name = "github_light",
		colorscheme = "github_light",
		appearance = "light",
		plugin = {
			"projekt0n/github-nvim-theme",
			name = "github-theme",
			opts = {},
		},
	},
	{
		name = "github_light_default",
		colorscheme = "github_light_default",
		appearance = "light",
		plugin = {
			"projekt0n/github-nvim-theme",
			name = "github-theme",
			opts = {},
		},
	},
	{
		name = "github_light_high_contrast",
		colorscheme = "github_light_high_contrast",
		appearance = "light",
		plugin = {
			"projekt0n/github-nvim-theme",
			name = "github-theme",
			opts = {},
		},
	},
	{
		name = "github_light_colorblind",
		colorscheme = "github_light_colorblind",
		appearance = "light",
		plugin = {
			"projekt0n/github-nvim-theme",
			name = "github-theme",
			opts = {},
		},
	},
	{
		name = "github_light_tritanopia",
		colorscheme = "github_light_tritanopia",
		appearance = "light",
		plugin = {
			"projekt0n/github-nvim-theme",
			name = "github-theme",
			opts = {},
		},
	},
	{
		name = "kanagawa_wave",
		colorscheme = "kanagawa",
		appearance = "dark",
		plugin = {
			"rebelot/kanagawa.nvim",
			name = "kanagawa",
			opts = { theme = "wave" },
		},
	},
	{
		name = "kanagawa_dragon",
		colorscheme = "kanagawa",
		appearance = "dark",
		plugin = {
			"rebelot/kanagawa.nvim",
			name = "kanagawa",
			opts = { theme = "dragon" },
		},
	},
	{
		name = "kanagawa_lotus",
		colorscheme = "kanagawa",
		appearance = "light",
		plugin = {
			"rebelot/kanagawa.nvim",
			name = "kanagawa",
			opts = { theme = "lotus" },
		},
	},
	{
		name = "gruvbox_dark",
		colorscheme = "gruvbox",
		appearance = "dark",
		plugin = {
			"ellisonleao/gruvbox.nvim",
			name = "gruvbox",
			opts = { contrast = "" },
		},
	},
	{
		name = "gruvbox_dark_hard",
		colorscheme = "gruvbox",
		appearance = "dark",
		plugin = {
			"ellisonleao/gruvbox.nvim",
			name = "gruvbox",
			opts = { contrast = "hard" },
		},
	},
	{
		name = "gruvbox_dark_soft",
		colorscheme = "gruvbox",
		appearance = "dark",
		plugin = {
			"ellisonleao/gruvbox.nvim",
			name = "gruvbox",
			opts = { contrast = "soft" },
		},
	},
	{
		name = "gruvbox_light",
		colorscheme = "gruvbox",
		appearance = "light",
		plugin = {
			"ellisonleao/gruvbox.nvim",
			name = "gruvbox",
			opts = { contrast = "" },
		},
	},
	{
		name = "gruvbox_light_hard",
		colorscheme = "gruvbox",
		appearance = "light",
		plugin = {
			"ellisonleao/gruvbox.nvim",
			name = "gruvbox",
			opts = { contrast = "hard" },
		},
	},
	{
		name = "gruvbox_light_soft",
		colorscheme = "gruvbox",
		appearance = "light",
		plugin = {
			"ellisonleao/gruvbox.nvim",
			name = "gruvbox",
			opts = { contrast = "soft" },
		},
	},
	{
		name = "dracula",
		colorscheme = "dracula",
		appearance = "dark",
		plugin = {
			"Mofiqul/dracula.nvim",
			name = "dracula",
			opts = {},
		},
	},
	{
		name = "dracula_soft",
		colorscheme = "dracula-soft",
		appearance = "dark",
		plugin = {
			"Mofiqul/dracula.nvim",
			name = "dracula",
			opts = { theme = "dracula-soft" },
		},
	},
	{
		name = "vscode_dark",
		colorscheme = "vscode",
		appearance = "dark",
		plugin = {
			"Mofiqul/vscode.nvim",
			name = "vscode",
			opts = {},
		},
	},
	{
		name = "vscode_light",
		colorscheme = "vscode",
		appearance = "light",
		plugin = {
			"Mofiqul/vscode.nvim",
			name = "vscode",
			opts = {},
		},
	},
	{
		name = "onedark_dark",
		colorscheme = "onedark",
		appearance = "dark",
		plugin = {
			"navarasu/onedark.nvim",
			config = function()
				require('onedark').setup {
					style = 'dark'
				}
				require('onedark').load()
			end,
		},
	},
	{
		name = "onedark_darker",
		colorscheme = "onedark",
		appearance = "dark",
		plugin = {
			"navarasu/onedark.nvim",
			config = function()
				require('onedark').setup {
					style = 'darker'
				}
				require('onedark').load()
			end,
		},
	},
	{
		name = "onedark_cool",
		colorscheme = "onedark",
		appearance = "dark",
		plugin = {
			"navarasu/onedark.nvim",
			config = function()
				require('onedark').setup {
					style = 'cool'
				}
				require('onedark').load()
			end,
		},
	},
	{
		name = "onedark_deep",
		colorscheme = "onedark",
		appearance = "dark",
		plugin = {
			"navarasu/onedark.nvim",
			config = function()
				require('onedark').setup {
					style = 'deep'
				}
				require('onedark').load()
			end,
		},
	},
	{
		name = "onedark_warm",
		colorscheme = "onedark",
		appearance = "dark",
		plugin = {
			"navarasu/onedark.nvim",
			config = function()
				require('onedark').setup {
					style = 'warm'
				}
				require('onedark').load()
			end,
		},
	},
	{
		name = "onedark_warmer",
		colorscheme = "onedark",
		appearance = "dark",
		plugin = {
			"navarasu/onedark.nvim",
			config = function()
				require('onedark').setup {
					style = 'warmer'
				}
				require('onedark').load()
			end,
		},
	},
	{
		name = "onedark_light",
		colorscheme = "onedark",
		appearance = "light",
		plugin = {
			"navarasu/onedark.nvim",
			config = function()
				require('onedark').setup {
					style = 'light'
				}
				require('onedark').load()
			end,
		},
	},
	{
		name = "solarized_winter",
		colorscheme = "solarized",
		appearance = "dark",
		plugin = {
			"maxmx03/solarized.nvim",
			name = "solarized",
			opts = { variant = "winter" },
		},
	},
	{
		name = "solarized_spring",
		colorscheme = "solarized",
		appearance = "dark",
		plugin = {
			"maxmx03/solarized.nvim",
			name = "solarized",
			opts = { variant = "spring" },
		},
	},
	{
		name = "solarized_summer",
		colorscheme = "solarized",
		appearance = "dark",
		plugin = {
			"maxmx03/solarized.nvim",
			name = "solarized",
			opts = { variant = "summer" },
		},
	},
	{
		name = "solarized_autumn",
		colorscheme = "solarized",
		appearance = "dark",
		plugin = {
			"maxmx03/solarized.nvim",
			name = "solarized",
			opts = { variant = "autumn" },
		},
	},
	{
		name = "material_darker",
		colorscheme = "material-darker",
		appearance = "dark",
		plugin = {
			"marko-cerovac/material.nvim",
			config = function()
				vim.g.material_style = "darker"
				require("material").setup({})
				vim.g.material_style = nil
			end,
		},
	},
	{
		name = "material_lighter",
		colorscheme = "material-lighter",
		appearance = "light",
		plugin = {
			"marko-cerovac/material.nvim",
			config = function()
				vim.g.material_style = "lighter"
				require("material").setup({})
				vim.g.material_style = nil
			end,
		},
	},
	{
		name = "material_oceanic",
		colorscheme = "material-oceanic",
		appearance = "dark",
		plugin = {
			"marko-cerovac/material.nvim",
			config = function()
				vim.g.material_style = "oceanic"
				require("material").setup({})
				vim.g.material_style = nil
			end,
		},
	},
	{
		name = "material_palenight",
		colorscheme = "material-palenight",
		appearance = "dark",
		plugin = {
			"marko-cerovac/material.nvim",
			config = function()
				vim.g.material_style = "palenight"
				require("material").setup({})
				vim.g.material_style = nil
			end,
		},
	},
	{
		name = "material_deep_ocean",
		colorscheme = "material-deep-ocean",
		appearance = "dark",
		plugin = {
			"marko-cerovac/material.nvim",
			config = function()
				vim.g.material_style = "deep ocean"
				require("material").setup({})
				vim.g.material_style = nil
			end,
		},
	},
	{
		name = "nord",
		colorscheme = "nord",
		appearance = "dark",
		plugin = {
			"shaunsingh/nord.nvim",
			name = "nord",
			opts = {},
		},
	},
	{
		name = "onedarkpro",
		colorscheme = "onedark",
		appearance = "dark",
		plugin = {
			"olimorris/onedarkpro.nvim",
			name = "onedarkpro",
			opts = {},
		},
	},
	{
		name = "onedarkpro_light",
		colorscheme = "onelight",
		appearance = "light",
		plugin = {
			"olimorris/onedarkpro.nvim",
			name = "onedarkpro",
			opts = {},
		},
	},
	{
		name = "onedarkpro_vivid",
		colorscheme = "onedark_vivid",
		appearance = "dark",
		plugin = {
			"olimorris/onedarkpro.nvim",
			name = "onedarkpro",
			opts = {},
		},
	},
	{
		name = "onedarkpro_dark",
		colorscheme = "onedark_dark",
		appearance = "dark",
		plugin = {
			"olimorris/onedarkpro.nvim",
			name = "onedarkpro",
			opts = {},
		},
	},
	-- Nightfox Collection
	{
		name = "nightfox",
		colorscheme = "nightfox",
		appearance = "dark",
		plugin = {
			"EdenEast/nightfox.nvim",
			name = "nightfox",
			opts = {},
		},
	},
	{
		name = "dayfox",
		colorscheme = "dayfox",
		appearance = "light",
		plugin = {
			"EdenEast/nightfox.nvim",
			name = "nightfox",
			opts = {},
		},
	},
	{
		name = "duskfox",
		colorscheme = "duskfox",
		appearance = "dark",
		plugin = {
			"EdenEast/nightfox.nvim",
			name = "nightfox",
			opts = {},
		},
	},
	{
		name = "dawnfox",
		colorscheme = "dawnfox",
		appearance = "light",
		plugin = {
			"EdenEast/nightfox.nvim",
			name = "nightfox",
			opts = {},
		},
	},
	{
		name = "carbonfox",
		colorscheme = "carbonfox",
		appearance = "dark",
		plugin = {
			"EdenEast/nightfox.nvim",
			name = "nightfox",
			opts = {},
		},
	},
	{
		name = "terafox",
		colorscheme = "terafox",
		appearance = "dark",
		plugin = {
			"EdenEast/nightfox.nvim",
			name = "nightfox",
			opts = {},
		},
	},
	-- Rose Pine Collection
	{
		name = "rosepine",
		colorscheme = "rose-pine",
		appearance = "dark",
		plugin = {
			"rose-pine/neovim",
			name = "rose-pine",
			opts = {},
		},
	},
	{
		name = "rosepine_moon",
		colorscheme = "rose-pine-moon",
		appearance = "dark",
		plugin = {
			"rose-pine/neovim",
			name = "rose-pine",
			opts = { variant = "moon" },
		},
	},
	{
		name = "rosepine_dawn",
		colorscheme = "rose-pine-dawn",
		appearance = "light",
		plugin = {
			"rose-pine/neovim",
			name = "rose-pine",
			opts = { variant = "dawn" },
		},
	},
	-- Everforest Collection
	{
		name = "everforest_dark",
		colorscheme = "everforest",
		appearance = "dark",
		plugin = {
			"sainnhe/everforest",
			name = "everforest",
			opts = {},
		},
	},
	{
		name = "everforest_dark_hard",
		colorscheme = "everforest",
		appearance = "dark",
		plugin = {
			"sainnhe/everforest",
			name = "everforest",
			opts = { background = "hard" },
		},
	},
	{
		name = "everforest_dark_soft",
		colorscheme = "everforest",
		appearance = "dark",
		plugin = {
			"sainnhe/everforest",
			name = "everforest",
			opts = { background = "soft" },
		},
	},
	{
		name = "everforest_light",
		colorscheme = "everforest",
		appearance = "light",
		plugin = {
			"sainnhe/everforest",
			name = "everforest",
			opts = {},
		},
	},
	{
		name = "everforest_light_hard",
		colorscheme = "everforest",
		appearance = "light",
		plugin = {
			"sainnhe/everforest",
			name = "everforest",
			opts = { background = "hard" },
		},
	},
	{
		name = "everforest_light_soft",
		colorscheme = "everforest",
		appearance = "light",
		plugin = {
			"sainnhe/everforest",
			name = "everforest",
			opts = { background = "soft" },
		},
	},
	-- Monokai Pro Collection
	{
		name = "monokai_pro",
		colorscheme = "monokai-pro",
		appearance = "dark",
		plugin = {
			"loctvl842/monokai-pro.nvim",
			name = "monokai-pro",
			opts = {},
		},
	},
	{
		name = "monokai_pro_classic",
		colorscheme = "monokai-pro-classic",
		appearance = "dark",
		plugin = {
			"loctvl842/monokai-pro.nvim",
			name = "monokai-pro",
			opts = { filter = "classic" },
		},
	},
	{
		name = "monokai_pro_machine",
		colorscheme = "monokai-pro-machine",
		appearance = "dark",
		plugin = {
			"loctvl842/monokai-pro.nvim",
			name = "monokai-pro",
			opts = { filter = "machine" },
		},
	},
	{
		name = "monokai_pro_octagon",
		colorscheme = "monokai-pro-octagon",
		appearance = "dark",
		plugin = {
			"loctvl842/monokai-pro.nvim",
			name = "monokai-pro",
			opts = { filter = "octagon" },
		},
	},
	{
		name = "monokai_pro_ristretto",
		colorscheme = "monokai-pro-ristretto",
		appearance = "dark",
		plugin = {
			"loctvl842/monokai-pro.nvim",
			name = "monokai-pro",
			opts = { filter = "ristretto" },
		},
	},
	{
		name = "monokai_pro_spectrum",
		colorscheme = "monokai-pro-spectrum",
		appearance = "dark",
		plugin = {
			"loctvl842/monokai-pro.nvim",
			name = "monokai-pro",
			opts = { filter = "spectrum" },
		},
	},
	-- Oxocarbon Collection
	{
		name = "oxocarbon",
		colorscheme = "oxocarbon",
		appearance = "dark",
		plugin = {
			"nyoom-engineering/oxocarbon.nvim",
			name = "oxocarbon",
			opts = {},
		},
	},
	{
		name = "oxocarbon_light",
		colorscheme = "oxocarbon",
		appearance = "light",
		plugin = {
			"nyoom-engineering/oxocarbon.nvim",
			name = "oxocarbon",
			opts = {},
		},
	},
	-- Ayu Collection
	{
		name = "ayu_dark",
		colorscheme = "ayu-dark",
		appearance = "dark",
		plugin = {
			"Shatur/neovim-ayu",
			name = "ayu",
			opts = {},
		},
	},
	{
		name = "ayu_mirage",
		colorscheme = "ayu-mirage",
		appearance = "dark",
		plugin = {
			"Shatur/neovim-ayu",
			name = "ayu",
			opts = {},
		},
	},
	{
		name = "ayu_light",
		colorscheme = "ayu-light",
		appearance = "light",
		plugin = {
			"Shatur/neovim-ayu",
			name = "ayu",
			opts = {},
		},
	},
	-- Melange
	{
		name = "melange",
		colorscheme = "melange",
		appearance = "dark",
		plugin = {
			"savq/melange-nvim",
			name = "melange",
			opts = {},
		},
	},
	-- Sonokai Collection
	{
		name = "sonokai",
		colorscheme = "sonokai",
		appearance = "dark",
		plugin = {
			"sainnhe/sonokai",
			name = "sonokai",
			opts = {},
		},
	},
	{
		name = "sonokai_atlantis",
		colorscheme = "sonokai",
		appearance = "dark",
		plugin = {
			"sainnhe/sonokai",
			name = "sonokai",
			opts = { style = "atlantis" },
		},
	},
	{
		name = "sonokai_andromeda",
		colorscheme = "sonokai",
		appearance = "dark",
		plugin = {
			"sainnhe/sonokai",
			name = "sonokai",
			opts = { style = "andromeda" },
		},
	},
	{
		name = "sonokai_shusia",
		colorscheme = "sonokai",
		appearance = "dark",
		plugin = {
			"sainnhe/sonokai",
			name = "sonokai",
			opts = { style = "shusia" },
		},
	},
	{
		name = "sonokai_maia",
		colorscheme = "sonokai",
		appearance = "dark",
		plugin = {
			"sainnhe/sonokai",
			name = "sonokai",
			opts = { style = "maia" },
		},
	},
	-- Moonfly
	{
		name = "moonfly",
		colorscheme = "moonfly",
		appearance = "dark",
		plugin = {
			"bluz71/vim-moonfly-colors",
			name = "moonfly",
			opts = {},
		},
	},
	-- Poimandres
	{
		name = "poimandres",
		colorscheme = "poimandres",
		appearance = "dark",
		plugin = {
			"olivercederborg/poimandres.nvim",
			name = "poimandres",
			opts = {},
		},
	},
}

local highlight_groups = {
	"Normal",
	"Comment",
	"@attribute",
	"@attribute.builtin",
	"@boolean",
	"@character",
	"@character.special",
	"@charset",
	"@clicke",
	"@comment",
	"@comment.documentation",
	"@constant",
	"@constant.builtin",
	"@constant.macro",
	"@constructor",
	"@diff.minus",
	"@diff.plus",
	"@error",
	"@function",
	"@function.builtin",
	"@function.call",
	"@function.macro",
	"@function.method",
	"@function.method.call",
	"@import",
	"@indent.begin",
	"@indent.branch",
	"@indent.end",
	"@indent.ignore",
	"@injection.content",
	"@injection.language",
	"@keyframes",
	"@keyword",
	"@keyword.conditional",
	"@keyword.conditional.ternary",
	"@keyword.coroutine",
	"@keyword.debug",
	"@keyword.directive",
	"@keyword.directive.define",
	"@keyword.exception",
	"@keyword.function",
	"@keyword.import",
	"@keyword.modifier",
	"@keyword.operator",
	"@keyword.repeat",
	"@keyword.return",
	"@keyword.type",
	"@label",
	"@local.definition",
	"@local.definition.associated",
	"@local.definition.field",
	"@local.definition.function",
	"@local.definition.import",
	"@local.definition.macro",
	"@local.definition.method",
	"@local.definition.namespace",
	"@local.definition.parameter",
	"@local.definition.type",
	"@local.definition.var",
	"@local.reference",
	"@local.scope",
	"@markup.heading",
	"@markup.heading.1",
	"@markup.heading.2",
	"@markup.heading.3",
	"@markup.heading.4",
	"@markup.heading.5",
	"@markup.heading.6",
	"@markup.italic",
	"@markup.link.label",
	"@markup.raw",
	"@markup.strikethrough",
	"@markup.strong",
	"@markup.underline",
	"@media",
	"@module",
	"@module.builtin",
	"@namespace",
	"@none",
	"@number",
	"@number.float",
	"@operator",
	"@property",
	"@punctuation.bracket",
	"@punctuation.delimiter",
	"@punctuation.special",
	"@string",
	"@string.documentation",
	"@string.escape",
	"@string.regexp",
	"@string.special",
	"@string.special.path",
	"@string.special.symbol",
	"@string.special.url",
	"@supports",
	"@tag",
	"@tag.attribute",
	"@tag.delimiter",
	"@type",
	"@type.builtin",
	"@type.definition",
	"@variable",
	"@variable.builtin",
	"@variable.member",
	"@variable.parameter",
	"@variable.parameter.builtin",
}

local function extract_colorscheme_colors(theme_def)
	local theme_name = theme_def.name
	local colorscheme_name = theme_def.colorscheme
	local appearance = theme_def.appearance

	print(string.format("%s (colorscheme: %s, appearance: %s)", theme_name, colorscheme_name, appearance))

	vim.cmd("colorscheme default")

	local preserved_modules = {
		"_G",
		"bit",
		"coroutine",
		"debug",
		"io",
		"lazy",
		"math",
		"os",
		"package",
		"string",
		"table",
		"vim",
		"jit",
	}
	local preserve_list = {}
	for _, mod in ipairs(preserved_modules) do
		preserve_list[mod] = true
	end

	for k in pairs(package.loaded) do
		if not preserve_list[k] then
			package.loaded[k] = nil
		end
	end

	vim.opt.termguicolors = true
	vim.o.background = appearance

	local success, err = pcall(vim.cmd, "colorscheme " .. colorscheme_name)
	if not success then
		print(string.format("Error loading colorscheme for %s: %s", theme_name, err))
		return false
	end

	local highlights = {}

	for _, group in ipairs(highlight_groups) do
		local hl = vim.api.nvim_get_hl(0, { name = group, link = false })
		local style = {}

		if hl.fg then
			style.fg = string.format("#%06x", hl.fg)
		end

		if hl.bg then
			style.bg = string.format("#%06x", hl.bg)
		end

		if hl.bold then
			style.bold = true
		end
		if hl.italic then
			style.italic = true
		end
		if hl.underline then
			style.underline = true
		end
		if hl.undercurl then
			style.undercurl = true
		end
		if hl.strikethrough then
			style.strikethrough = true
		end

		if next(style) ~= nil then
			highlights[string.lower(string.gsub(group, "@", ""))] = style
		end
	end

	local output_file = theme_name .. ".json"
	local theme_data = {
		name = theme_name,
		appearance = appearance,
		highlights = highlights,
	}

	local json_str = vim.json.encode(theme_data)
	local file = io.open(output_file, "w")
	if file then
		file:write(json_str)
		file:close()

		local jq_cmd = [[jq '
      {
        name,
        appearance,
        highlights: (.highlights | to_entries | sort_by(.key) | map({
          key: .key,
          value: {
            bg: .value.bg,
            bold: .value.bold,
            fg: .value.fg,
            italic: .value.italic,
            strikethrough: .value.strikethrough,
            undercurl: .value.undercurl,
            underline: .value.underline
          } | with_entries(select(.value != null))
        }) | from_entries)
      }' ]] .. output_file .. " > " .. output_file .. ".tmp && mv " .. output_file .. ".tmp " .. output_file

		local jq_result = vim.fn.system(jq_cmd)

		if vim.v.shell_error ~= 0 then
			print("Warning: jq processing failed: " .. jq_result)
		end

		return true
	else
		print(string.format("Error: Could not write to file %s", output_file))
		return false
	end
end

local plugins = {}
for _, theme_def in ipairs(themes) do
	local plugin = vim.deepcopy(theme_def.plugin)
	plugin.lazy = false
	plugin.priority = 1000
	table.insert(plugins, plugin)
end

require("lazy").setup(plugins, {
	install = {
		colorscheme = { "default" },
	},
	ui = {
		border = "none",
		icons = {
			cmd = "",
			config = "",
			event = "",
			ft = "",
			init = "",
			keys = "",
			plugin = "",
			runtime = "",
			source = "",
			start = "",
			task = "",
		},
		throttle = 99999999,
	},
	checker = {
		enabled = false,
	},
})

for _, theme_def in ipairs(themes) do
	extract_colorscheme_colors(theme_def)
end

vim.cmd("quit!")
